<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Cache Control: Prevent aggressive browser caching -->
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    
    <title>Gestione Rateazioni – Dashboard pagamenti e scadenze</title>
    <meta name="description" content="App professionale per gestione rateazioni con dashboard, grafici, allegati e scadenze. React, Tailwind, shadcn/ui." />
    <meta name="author" content="Lovable" />

    <meta property="og:title" content="Gestione Rateazioni" />
    <meta property="og:description" content="Dashboard riepilogativa, tabella rateazioni, grafici mensili e allegati su Supabase." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
    <link rel="canonical" href="/" />

    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:site" content="@lovable_dev" />
    <meta name="twitter:image" content="https://lovable.dev/opengraph-image-p98pqg.png" />
  </head>

  <body>
    <div id="root"></div>
    <!-- Service Worker: disabilitato per evitare cache/React mismatch -->
    <script>
      // Forza la rimozione di eventuali vecchi service worker e cache residue.
      // Se troviamo qualcosa da pulire, facciamo un solo reload (evita loop) per caricare chunk coerenti.
      const CLEANUP_FLAG = 'sw_cache_cleanup_done_v2';
      const canReloadOnce = !sessionStorage.getItem(CLEANUP_FLAG);

      const tasks: Promise<any>[] = [];

      if ('serviceWorker' in navigator) {
        tasks.push(
          navigator.serviceWorker.getRegistrations().then((regs) => {
            if (regs.length && canReloadOnce) sessionStorage.setItem(CLEANUP_FLAG, '1');
            return Promise.all(regs.map((r) => r.unregister()));
          })
        );
      }

      if (window.caches?.keys) {
        tasks.push(
          caches.keys().then((keys) => {
            if (keys.length && canReloadOnce) sessionStorage.setItem(CLEANUP_FLAG, '1');
            return Promise.all(keys.map((k) => caches.delete(k)));
          })
        );
      }

      Promise.all(tasks).finally(() => {
        if (canReloadOnce && sessionStorage.getItem(CLEANUP_FLAG) === '1') {
          // Reload “pulito” una sola volta
          window.location.reload();
        }
      });
    </script>

    <!-- Cache buster: Version parameter forces browser to reload on updates -->
    <script type="module" src="/src/main.tsx?v=20260125234000"></script>
  </body>
</html>
